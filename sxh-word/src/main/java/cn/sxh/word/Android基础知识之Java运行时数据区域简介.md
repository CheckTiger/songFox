### Android基础知识之Java运行时数据区域简介

1. 程序计数器
2. java虚拟机
3. 本地方法栈
4. 方法区
5. java堆
6. 运行时常量池

```tex
1.程序计数器
```

> 程序计数器是一块较小的内存空间，它可以当作是当前线程执行的字节码的行号执行器，在虚拟机的概念模型里，
> 字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，
> 分支，循环、跳转、异常处理、线程回复等基础功能都需要依赖这个计数器来完成
> 由于java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，
> 在一个任何确定的时刻，一个处理器都只会执行一条线程中的指令。因此为了线程切换后能恢复到正确的执行位置，
> 每条线程都需要有一个独立的程序计数器，各条线程之间计数器互不影响，我们称这类内区区域为线程私有区域的内存。

```tex
2.Java虚拟机栈
```

> java虚拟栈也是线程私有的，它的生命周期与线程相同。虚拟机栈描述的是java方法执行的内存模型，每个方法在执行的同时都会执行创建一个栈帧用于存储局部变量、操作数栈、动态链接、方法出口等信息。每一个方法从调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中入栈到出栈的过程。我们平常所说的栈内存指的就是java虚拟机栈。java虚拟机规范中定义了两种异常情况。

- 如果线程请求分配的栈容量超过java虚拟机所允许的最大容量，java虚拟机栈会抛出StackOverFlowError
- 如果java虚拟机栈可以动态扩展，但是扩展时无法申请到足够的内存，或者在创建的线程时没有足够的内存去创建对应的java虚拟机栈，则会抛出OutOfMemoryError异常

```tex
3.本地方法栈
```

> Java 虚拟机实现可能要用到 C Stacks 来支持 Native 语言 ，这个 C Stacks 就是本地方怯
> 枝（ Native Method Stack ）。它与 Java 虚拟机枝类似，只不过本地方怯枝是用来支持 Native
> 方峙的。如果 Java 虚拟机不支持 Native 方搓，并且也不依赖于 C Stacks ，可以无须支持本
> 地方怯枝。在 Java 虚拟机规范中对本地方住枝的语言和数据结构等没有强制规定，因此具
> 体的 Java 虚拟机可以自由实现它，比如 HotSpotVM 将本地方也枝和 Java 虚拟机枝合二为一 。
> 与 Java 虚拟机枝类似，本地方法校也会抛出 StackOverflowError 和 OutOfMemoryError 异常

```tex
4.java堆
```

> Java 堆(Java Heap ）是被所有线程共享的运行时内存区域。 Java 堆用来存放对象实例，几乎所有的对象实例都在这里分配内存。Java 堆存储的对象被垃圾收集器管理，这些受管理的对象无法显式地销毁。从内存回收的角度来分，Java 堆可以粗略地分为新生代和老年代，从内存分配的角度 Java 堆中可能划分出多个线程私有的分配缓冲区。不管如何划分，Java 堆存储的内容是不变的，进行划分是为了能更快地回收或者分配内存 。Java 堆的容量可以是固定的，也可以动态扩展。
> Java 堆所使用的内存在物理上不需要连续，逻辑上连续即可。Java 虚拟机规范中定义了 一种异常情况：如果在堆中没有足够的内存来完成实例分配，并且堆也无怯进行扩展时，则会抛出 OutOfMemoryError 异常。

```tex
5.方法区
```

> 方法区时被所有线程共享的运行时内存区域，用来存储已经被java虚拟机加载的类的结构信息，包括运行时常量池、字段和方法信息、静态变量等数据。方法区是java堆的逻辑组成部分，它一样在物理上不需要连续，并且可以选择在方法区中不实现垃圾收集。方法区并不等于永久代，只是因为hotspot VM使用永久代来实现方法区
>
> 	在Java 虚拟机规范中定义了一种异常情况：如果方法区的内存空间不满足内存分配需求时，
> 	Java 虚拟机会抛出 OutOfMemoryError 异常。

6.运行时常量池

> ​	运行时运行时常量地（ Runtime Constant Pool ）并不是运行时数据区域的其中一份子，而是方怯区的一部分。Class 文件不仅包含类的版本、接口、宇段和方住等信息 ，还包含常量池，它用来存放编译时期生成的字面量和符号引用，这些内容会在类加载后存放在方怯区的运行时常量池中 。运行时常量地可以理解为是类或接口的常量地的运行时表现形式。
>
> ​	在 Java 虚拟机规范中定义了一种异常情况 ： 当 创建类或接 口时，如果构造运行时常量地
> 所需的内存超过了方怯区所能提供的最大值，
> Java 虚拟机会抛出 OutOfMemoryError 异常。

